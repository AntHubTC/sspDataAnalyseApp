import{E as he,a as ge,b as $,c as oe,d as V,e as ne,v as ae,f as se,g as le,h as fe,i as q,j as ie,k as ve,l as De,m as re,n as ye}from"./element-plus-ff71f397.js";import{c as Ce}from"./vue3-contextmenu-faa5a5c9.js";import{a as be}from"./axios-4a70c6fc.js";import{Q as ke,B as xe,A as Se,R as we,S as Ie,T as Ee,U as Fe,V as Me,W as Pe,X as Ve,Y}from"./@element-plus-761d2d1a.js";import{ah as F,o as c,O as C,c as h,a as d,V as s,P as i,J as y,Q as M,W as T,T as _,bh as O,bf as H,d as J,U as f,a3 as D,S as g,F as L,h as Te,a1 as Ae,a8 as Q,X as de,A as Le,K as ee,as as Be}from"./@vue-3ce77758.js";import{d as Z,c as Ne}from"./pinia-60252675.js";import{c as Ue,a as qe}from"./vue-router-8ec242c0.js";import{C as E}from"./clipboard-c3c204ac.js";import{m as Oe}from"./mitt-f7ef348c.js";import{V as He}from"./vue-draggable-next-8e6609a8.js";import{s as te}from"./screenfull-b3e6dc1f.js";import{k as B}from"./keymaster-d2c39700.js";import{E as Re}from"./jspdf-019586dc.js";import We from"./html2canvas-e0a7d97b.js";import{j as ze}from"./jsplumb-211b3a96.js";import{I as Ge}from"./intro.js-0cd65a44.js";import"./lodash-es-36eb724a.js";import"./@vueuse-bf4bf870.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-131173c7.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-e93013b6.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-a8940911.js";import"./vue-44af34dc.js";import"./@babel-a3762aff.js";import"./fflate-8981c52c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();const A=be.create({baseURL:"/",timeout:1e4});A.interceptors.response.use(e=>new Promise((t,o)=>{if(e.status===200&&e.data){let l=e.data;return l.status!=="000000"?(he.error(l.data),o(e)):t(e.data.data)}return o(e)}),e=>new Promise((t,o)=>{if(e&&e.response)switch(e.response.status){case 400:e.message="请求错误(400)";break;case 401:e.message="未授权，请重新登录(401)";break;case 403:e.message="拒绝访问(403)";break;case 404:e.message="请求出错(404)";break;case 408:e.message="请求超时(408)";break;case 500:e.message="服务器错误(500)";break;case 501:e.message="服务未实现(501)";break;case 502:e.message="网络错误(502)";break;case 503:e.message="服务不可用(503)";break;case 504:e.message="网络超时(504)";break;case 505:e.message="HTTP版本不受支持(505)";break;default:e.message=`连接出错(${e.response.status})!`}else e.message="连接服务器失败!";return o(e)}));const w=(e,t)=>{const o=e.__vccOpts||e;for(const[l,a]of t)o[l]=a;return o},je={};function Qe(e,t){const o=F("router-view");return c(),C(o)}const $e=w(je,[["render",Qe]]),Je=e=>A.post("/treeData",{premisesId:e}),Ze=()=>A.get("/getUserConfig"),Xe=e=>A.post("/testConfig",e),Ke=e=>A.post("/setUserConfig",e),Ye={data(){return{formData:{},rules:{sspCookie:[{required:!0,message:"ssp archery token不能为空!",trigger:"change"}],rmCookie:[{required:!0,message:"rongmei archery token不能为空!",trigger:"change"}]},checkStatus:1}},methods:{async verifyConfigClick(){let e=this.$refs.ruleFormRef;e&&(this.checkStatus=2,e.validate((t,o)=>{if(!t){this.checkStatus=4;return}Xe(this.formData).then(()=>{Ke(this.formData).then(()=>{localStorage.setItem("srdUserConfig",JSON.stringify(this.formData)),this.checkStatus=3}).catch(()=>{this.checkStatus=4})}).catch(()=>{this.checkStatus=4})}))}},created(){Ze().then(e=>{e.rmCookie&&e.sspCookie?this.formData=e:localStorage.getItem("srdUserConfig")&&(e=JSON.parse(localStorage.getItem("srdUserConfig")),this.formData=e)})}};const et=e=>(O("data-v-47928cbb"),e=e(),H(),e),tt={class:"settings"},ot={class:"config-box"},nt=et(()=>d("div",{class:"card-header"},[d("h2",null,"使用配置")],-1)),at={class:"btn-box"},st={class:"btn-box"};function lt(e,t,o,l,a,n){const r=$,u=oe,p=V,m=F("router-link"),v=ne,b=ge,x=ae;return c(),h("div",tt,[d("div",ot,[s(b,{class:"box-card"},{header:i(()=>[nt]),default:i(()=>[s(v,{ref:"ruleFormRef",model:a.formData,rules:a.rules,"label-width":"220px",class:"demo-ruleForm","status-icon":""},{default:i(()=>[s(u,{label:"ssp archery token",prop:"sspCookie"},{default:i(()=>[s(r,{modelValue:a.formData.sspCookie,"onUpdate:modelValue":t[0]||(t[0]=I=>a.formData.sspCookie=I)},null,8,["modelValue"])]),_:1}),s(u,{label:"rongmei archery token",prop:"rmCookie"},{default:i(()=>[s(r,{modelValue:a.formData.rmCookie,"onUpdate:modelValue":t[1]||(t[1]=I=>a.formData.rmCookie=I)},null,8,["modelValue"])]),_:1}),d("div",{class:y(["check-status-bar",a.checkStatus==3?"success":a.checkStatus==4?"fail":""])},null,2),M(d("div",at,[M((c(),C(p,{type:"primary",onClick:n.verifyConfigClick},{default:i(()=>[_(" 验证配置 ")]),_:1},8,["onClick"])),[[x,a.checkStatus==2]])],512),[[T,a.checkStatus!=3]]),M(d("div",st,[s(m,{to:"/workspace"},{default:i(()=>[s(p,{type:"primary"},{default:i(()=>[_(" 进入 ")]),_:1})]),_:1})],512),[[T,a.checkStatus==3]])]),_:1},8,["model","rules"])]),_:1})])])}const it=w(Ye,[["render",lt],["__scopeId","data-v-47928cbb"]]),N=Z("fixDataTreeStore",()=>{const e=J(5);function t(l){e.value=l}function o(){return e.value}return{setCurrentLevel:t,getCurrentLevel:o}}),X=Z("drawerSettingStore",()=>{const e=J("all");function t(l){e.value=l}function o(){return e.value}return{setShowNodeMode:t,getShowNodeMode:o}}),rt={data(){return{drawerShow:!1,formData:{showNodeMode:"all"},rules:{showNodeMode:[{required:!0,message:"显示节点配置不能为空!",trigger:"change"}]}}},watch:{"formData.showNodeMode"(e){X().setShowNodeMode(e)}},methods:{showDrawer(){this.drawerShow=!0}}};const dt={class:"setting-drawer"};function ut(e,t,o,l,a,n){const r=se,u=le,p=oe,m=ne,v=fe;return c(),h("div",dt,[s(v,{modelValue:a.drawerShow,"onUpdate:modelValue":t[1]||(t[1]=b=>a.drawerShow=b),title:"设置",direction:"rtl"},{default:i(()=>[s(m,{ref:"ruleFormRef",model:a.formData,rules:a.rules,"label-width":"120px",class:"demo-ruleForm","status-icon":""},{default:i(()=>[s(p,{label:"显示节点配置",prop:"sspCookie"},{default:i(()=>[s(u,{modelValue:a.formData.showNodeMode,"onUpdate:modelValue":t[0]||(t[0]=b=>a.formData.showNodeMode=b)},{default:i(()=>[s(r,{label:"all"},{default:i(()=>[_("显示所有")]),_:1}),s(r,{label:"screen"},{default:i(()=>[_("显示屏")]),_:1}),s(r,{label:"frame"},{default:i(()=>[_("显示框")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const ct=w(rt,[["render",ut],["__scopeId","data-v-04ec9817"]]),mt={data(){return{centerDialogVisible:!1,textarea:""}},computed:{},methods:{openDialog(){this.centerDialogVisible=!0},closeDialog(){this.centerDialogVisible=!1},save(){E.copy(this.textarea),this.$message({message:"拷贝成功",type:"success"})}},mounted(){}};const _t={class:"dialog-footer"};function pt(e,t,o,l,a,n){const r=$,u=V,p=q;return c(),C(p,{modelValue:a.centerDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=m=>a.centerDialogVisible=m),title:"文本记录工具",width:"20%",center:"",class:"text-panel",draggable:"",modal:!0,"close-on-press-escape":!0,"close-on-click-modal":!0},{footer:i(()=>[d("span",_t,[s(u,{type:"primary",onClick:n.save},{default:i(()=>[_("确定")]),_:1},8,["onClick"])])]),default:i(()=>[d("div",null,[s(r,{modelValue:a.textarea,"onUpdate:modelValue":t[0]||(t[0]=m=>a.textarea=m),rows:20,type:"textarea",placeholder:"存放文本的地方"},null,8,["modelValue"])])]),_:1},8,["modelValue"])}const ht=w(mt,[["render",pt],["__scopeId","data-v-582663db"]]),gt={data(){return{centerDialogVisible:!1,premisesId:"593563"}},computed:{},methods:{openDialog(){this.centerDialogVisible=!0},closeDialog(){this.centerDialogVisible=!1},save(){this.premisesId&&(this.$emit("settingPremisesId",this.premisesId),this.closeDialog())}},mounted(){}};const ft=e=>(O("data-v-a1887b8f"),e=e(),H(),e),vt=ft(()=>d("span",null,"楼盘id(多个用逗号分割):",-1)),Dt={class:"dialog-footer"};function yt(e,t,o,l,a,n){const r=$,u=V,p=q;return c(),C(p,{modelValue:a.centerDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=m=>a.centerDialogVisible=m),title:"楼盘id设置",width:"20%",center:"",class:"set-premisesId-dialog"},{footer:i(()=>[d("span",Dt,[s(u,{type:"primary",onClick:n.save},{default:i(()=>[_("确定")]),_:1},8,["onClick"])])]),default:i(()=>[d("div",null,[vt,d("div",null,[s(r,{modelValue:a.premisesId,"onUpdate:modelValue":t[0]||(t[0]=m=>a.premisesId=m),placeholder:"请填写正确的楼盘id",clearable:""},null,8,["modelValue"])])])]),_:1},8,["modelValue"])}const Ct=w(gt,[["render",yt],["__scopeId","data-v-a1887b8f"]]),bt={components:{clipboard:E},data(){return{centerDialogVisible:!1,loadingInstance:null,sspSqlContent:"",rmSqlContent:""}},computed:{},methods:{copySql(e,t){let o=new E(e,{text:function(l){return t}});o.on("success",l=>{this.$message({message:"复制成功",type:"success"}),o.destroy()}),o.on("error",l=>{this.$message({message:"复制失败",type:"error"}),o.destroy()})},recursionTreeDataFun(e,t){if(e!==null)for(let o of e.items)t(e,o),this.recursionTreeDataFun(o,t)},getNodePath(e){let t=[];do e.depth==4?t.push(e.data.eleNum):t.push(e.title),e=e.parent;while(e);return"-- "+t.reverse().join(" / ")+`\r
`},showSql(e){debugger;this.sspSqlContent="",this.rmSqlContent="",this.openDialog(),this.$nextTick(()=>{let t=`use ssp3;\r
`,o=`use common-crm;\r
`;for(let l of e)this.recursionTreeDataFun(l.leftData,(a,n)=>{n.depth===2?(t+=this.getNodePath(n),t+=`update \`ssp3\`.\`build\` set premises_id = ${a.id}`):n.depth===3?(t+=this.getNodePath(n),t+=`update \`ssp3\`.\`unit\` set premises_id = ${a.parent.id}, build_id=${a.id}`):n.depth===4?(t+=this.getNodePath(n),t+=`update \`ssp3\`.\`elevator\` set premises_id = ${a.parent.parent.id}, build_id=${a.parent.id}, unit_id=${a.id}`):n.depth===5&&(t+=this.getNodePath(n),n.data.type==1?t+=`update \`ssp3\`.\`point\` set premises_id = ${a.parent.parent.parent.id}, build_id=${a.parent.parent.id}, unit_id=${a.parent.id}, ele_id=${a.id}`:t+=`update \`ssp3\`.\`media\` set premises_id = ${a.parent.parent.parent.id}, build_id=${a.parent.parent.id}, unit_id=${a.parent.id}, elevator_id=${a.id}`),t+=` where id=${n.id};\r
`}),this.recursionTreeDataFun(l.rightData,(a,n)=>{n.depth===2?(o+=this.getNodePath(n),o+=`update \`common-crm\`.\`resource_building\` set project_id = "${a.id}"`):n.depth===3?(o+=this.getNodePath(n),o+=`update \`common-crm\`.\`resource_unit\` set building_id="${a.id}"`):n.depth===4?(o+=this.getNodePath(n),o+=`update \`common-crm\`.\`resource_elevator\` set building_id="${a.parent.id}", unit_id="${a.id}"`):n.depth===5&&(o+=this.getNodePath(n),o+=`update \`common-crm\`.\`resource_media\` set building_id="${a.parent.parent.id}", unit_id="${a.parent.id}", elevator_id="${a.id}"`),o+=` where id="${n.id}";\r
`});this.sspSqlContent=t,this.rmSqlContent=o})},toggleLoading(e){e?this.loadingInstance=ie.service({lock:!0,text:"正在生成SQL中……",background:"rgba(0, 0, 0, 0.7)"}):(this.loadingInstance.close(),this.loadingInstance=null)},openDialog(){this.centerDialogVisible=!0},closeDialog(){this.toggleLoading(!1),this.centerDialogVisible=!1}},mounted(){}};const kt=e=>(O("data-v-cbcdb391"),e=e(),H(),e),xt={class:"sql-content"},St={style:{"margin-top":"10px"}},wt={class:"sql-content"},It=kt(()=>d("span",{class:"dialog-footer"},null,-1));function Et(e,t,o,l,a,n){const r=V,u=ve,p=q;return c(),C(p,{modelValue:a.centerDialogVisible,"onUpdate:modelValue":t[2]||(t[2]=m=>a.centerDialogVisible=m),title:"最终关系SQL语句生成",center:"",class:"export-datagram-dialog"},{footer:i(()=>[It]),default:i(()=>[d("div",null,[d("div",null,[_(" SSP部分SQL： "),s(u,{class:"box-item",effect:"dark",content:"这个按钮用于复制SSP的SQL",placement:"right"},{default:i(()=>[s(r,{size:"small",icon:"CopyDocument",onClick:t[0]||(t[0]=m=>n.copySql("#copySspSqlBtn",a.sspSqlContent)),id:"copySspSqlBtn"})]),_:1})]),d("div",xt,[d("pre",null,f(a.sspSqlContent),1)]),d("div",St,[_(" 融媒部分SQL： "),s(u,{class:"box-item",effect:"dark",content:"这个按钮用于复制融媒的SQL",placement:"right"},{default:i(()=>[s(r,{size:"small",icon:"CopyDocument",onClick:t[1]||(t[1]=m=>n.copySql("#copyRmSqlBtn",a.rmSqlContent)),id:"copyRmSqlBtn"})]),_:1})]),d("div",wt,[d("pre",null,f(a.rmSqlContent),1)])])]),_:1},8,["modelValue"])}const Ft=w(bt,[["render",Et],["__scopeId","data-v-cbcdb391"]]),Mt={data(){return{centerDialogVisible:!1,loadingInstance:null,dataRange:1}},computed:{},methods:{toggleLoading(e){e?this.loadingInstance=ie.service({lock:!0,text:"正在导出中……",background:"rgba(0, 0, 0, 0.7)"}):(this.loadingInstance.close(),this.loadingInstance=null)},openDialog(){this.centerDialogVisible=!0},closeDialog(){this.toggleLoading(!1),this.centerDialogVisible=!1},exportPNG(){this.toggleLoading(!0),this.$emit("exportPNG",this.dataRange)},exportPDF(){this.toggleLoading(!0),this.$emit("exportPDF",this.dataRange)}},mounted(){}};const ue=e=>(O("data-v-bd8469e5"),e=e(),H(),e),Pt=ue(()=>d("div",null,"要导出哪些呢?",-1)),Vt=ue(()=>d("span",null,"您想导出哪种格式的图呢？这里支持PNG和PDF，请选择你想要导出的格式",-1)),Tt={class:"dialog-footer"};function At(e,t,o,l,a,n){const r=se,u=le,p=V,m=q;return c(),C(m,{modelValue:a.centerDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=v=>a.centerDialogVisible=v),title:"数据图导出",width:"30%",center:"",class:"export-datagram-dialog"},{footer:i(()=>[d("span",Tt,[s(p,{onClick:n.exportPNG},{default:i(()=>[_("PNG")]),_:1},8,["onClick"]),s(p,{type:"primary",onClick:n.exportPDF},{default:i(()=>[_("PDF")]),_:1},8,["onClick"])])]),default:i(()=>[d("div",null,[Pt,d("div",null,[s(u,{modelValue:a.dataRange,"onUpdate:modelValue":t[0]||(t[0]=v=>a.dataRange=v),class:"ml-4"},{default:i(()=>[s(r,{label:1,size:"large"},{default:i(()=>[_("全部")]),_:1}),s(r,{label:2,size:"large"},{default:i(()=>[_("SSP部分")]),_:1}),s(r,{label:3,size:"large"},{default:i(()=>[_("融媒部分")]),_:1})]),_:1},8,["modelValue"])]),Vt])]),_:1},8,["modelValue"])}const ce=w(Mt,[["render",At],["__scopeId","data-v-bd8469e5"]]),j=Z("dragStore",()=>{const e=J(null);function t(l){e.value=l}function o(){return e.value}return{setDragData:t,getDragData:o}}),U=Oe(),Lt={props:{dataModel:{type:Object,required:!0},direction:{type:String}},emits:["toggleShow","nodeClick"],data(){return{}},computed:{nodeContainerDynamicClass(){return{"left-direction":this.direction=="left","right-direction":this.direction=="right"}},dataNodeItemDynamicClass(){return{"premises-item":this.dataModel.nodeType==="premises","build-item":this.dataModel.nodeType==="build","unit-item":this.dataModel.nodeType==="unit","ele-item":this.dataModel.nodeType==="ele","point-item":this.dataModel.nodeType==="point"}},currentDataNodeLevel(){return N().getCurrentLevel()}},methods:{nodeItemAnalyaseClass(e){let t=!1;return this.direction=="left"?this.dataModel.depth==3?e=="premises"&&(t=this.dataModel.data.unitPremisesId==this.dataModel.parent.parent.id):this.dataModel.depth==4?e=="premises"?t=this.dataModel.data.elePremisesId==this.dataModel.parent.parent.parent.id:e=="build"&&(t=this.dataModel.data.eleBuildId==this.dataModel.parent.parent.id):this.dataModel.depth==5&&(e=="premises"?t=this.dataModel.data.pointPremisesId==this.dataModel.parent.parent.parent.parent.id:e=="build"?t=this.dataModel.data.pointBuildId==this.dataModel.parent.parent.parent.id:e=="unit"&&(t=this.dataModel.data.pointUnitId==this.dataModel.parent.parent.id)):this.dataModel.depth==4?e=="build"&&(t=this.dataModel.data.eleBuildId==this.dataModel.parent.parent.id):this.dataModel.depth==5&&(e=="build"?t=this.dataModel.data.pointBuildId==this.dataModel.parent.parent.parent.id:e=="unit"&&(t=this.dataModel.data.pointUnitId==this.dataModel.parent.parent.id)),{"exist-error":!t,"node-name":!0}},show(){this.$emit("toggleShow",!0)},hide(){this.$emit("toggleShow",!1)},dragStart(){j().setDragData(this.dataModel)},dragover(e){let t=j().getDragData(),o=this.dataModel;t.group!=o.group||t.parent.id==o.id||t.depth-o.depth!=1||e.preventDefault()},drop(e){e.preventDefault();let t=j().getDragData(),o=this.dataModel,l=t.parent.items.indexOf(t);l>-1&&t.parent.items.splice(l,1),t.parent=o,o.items.push(t),console.info("drop"),console.info(t),console.info(o)},nodeClick(){this.$emit("nodeClick",this.dataModel)},contextmenuHandler(e){e.preventDefault(),U.emit("nodeContextMenu",{event:e,nodeData:this.dataModel})}},mounted(){this.dataModel.loadStatus=1}};const Bt=["id"],Nt={key:0,class:"node-tool"},Ut={class:"node-name"},qt={class:"node-name"},Ot={class:"node-name"},Ht={key:0,class:"node-name"},Rt={class:"node-name"},Wt={class:"node-name"},zt={key:0,class:"node-name"},Gt={key:1,class:"node-name"},jt={key:2};function Qt(e,t,o,l,a,n){const r=F("folder-add"),u=De,p=F("folder-remove");return c(),h("div",{class:y(["node-container",n.nodeContainerDynamicClass]),onContextmenu:t[4]||(t[4]=(...m)=>n.contextmenuHandler&&n.contextmenuHandler(...m))},[d("div",{id:`node_${o.dataModel.nodeType}_${o.dataModel.id}`,class:y(["data-node-item",n.dataNodeItemDynamicClass]),draggable:"true",onDragstart:t[0]||(t[0]=(...m)=>n.dragStart&&n.dragStart(...m)),onDragover:t[1]||(t[1]=(...m)=>n.dragover&&n.dragover(...m)),onDrop:t[2]||(t[2]=(...m)=>n.drop&&n.drop(...m)),onClick:t[3]||(t[3]=D((...m)=>n.nodeClick&&n.nodeClick(...m),["prevent"]))},[o.dataModel.items&&o.dataModel.items.length&&n.currentDataNodeLevel>o.dataModel.depth?(c(),h("div",Nt,[o.dataModel.hideChild?(c(),C(u,{key:0,onClick:D(n.hide,["prevent"])},{default:i(()=>[s(r)]),_:1},8,["onClick"])):(c(),C(u,{key:1,onClick:D(n.show,["prevent"])},{default:i(()=>[s(p)]),_:1},8,["onClick"]))])):g("",!0),o.direction=="right"?(c(),h(L,{key:1},[d("div",Ut,"id:"+f(o.dataModel.id),1),d("div",qt,"名称: "+f(o.dataModel.title),1),d("div",Ot,"sspId: "+f(o.dataModel.data.sspId||"无"),1),o.dataModel.depth==4?(c(),h("div",Ht,"电梯编码: "+f(o.dataModel.data.eleNum||"无"),1)):g("",!0),o.dataModel.depth==4?(c(),h("div",{key:1,class:y(n.nodeItemAnalyaseClass("build"))},"楼栋id: "+f(o.dataModel.data.eleBuildId),3)):g("",!0),o.dataModel.depth==5?(c(),h("div",{key:2,class:y(n.nodeItemAnalyaseClass("unit"))},"单元id: "+f(o.dataModel.data.pointUnitId),3)):g("",!0),o.dataModel.depth==5?(c(),h("div",{key:3,class:y(n.nodeItemAnalyaseClass("build"))},"楼栋id: "+f(o.dataModel.data.pointBuildId),3)):g("",!0)],64)):(c(),h(L,{key:2},[d("div",Rt,"ID: "+f(o.dataModel.id),1),d("div",Wt,"名称: "+f(o.dataModel.title||"用户未设置"),1),o.dataModel.depth==5?(c(),h("div",zt,"终端类型: "+f(o.dataModel.data.type=="1"?"屏":"框"),1)):g("",!0),o.dataModel.depth==4?(c(),h("div",Gt,"电梯编码: "+f(o.dataModel.data.eleNum||"无"),1)):g("",!0),o.dataModel.depth==1||o.dataModel.depth==2?(c(),h("br",jt)):g("",!0),o.dataModel.depth==3?(c(),h("div",{key:3,class:y(n.nodeItemAnalyaseClass("premises"))},"楼盘id: "+f(o.dataModel.data.unitPremisesId),3)):g("",!0),o.dataModel.depth==4?(c(),h("div",{key:4,class:y(n.nodeItemAnalyaseClass("build"))},"楼栋id: "+f(o.dataModel.data.eleBuildId),3)):g("",!0),o.dataModel.depth==4?(c(),h("div",{key:5,class:y(n.nodeItemAnalyaseClass("premises"))},"楼盘id: "+f(o.dataModel.data.elePremisesId),3)):g("",!0),o.dataModel.depth==5?(c(),h("div",{key:6,class:y(n.nodeItemAnalyaseClass("unit"))},"单元id: "+f(o.dataModel.data.pointUnitId),3)):g("",!0),o.dataModel.depth==5?(c(),h("div",{key:7,class:y(n.nodeItemAnalyaseClass("build"))},"楼栋id: "+f(o.dataModel.data.pointBuildId),3)):g("",!0),o.dataModel.depth==5?(c(),h("div",{key:8,class:y(n.nodeItemAnalyaseClass("premises"))},"楼盘id: "+f(o.dataModel.data.pointPremisesId),3)):g("",!0)],64))],42,Bt)],34)}const $t=w(Lt,[["render",Qt],["__scopeId","data-v-b3e89278"]]);Te();const Jt={components:{VueDraggableNext:He},props:{modelValue:{type:Object,required:!0},direction:{type:String}},emits:["update:modelValue"],data(){return{}},computed:{treeDataNodeClass(){return{"left-direction":this.direction=="left","right-direction":this.direction=="right"}},showCurrentNode(){if(this.modelValue.depth!==5||this.direction!=="left")return!0;const e=X().getShowNodeMode();return this.modelValue.data.type=="1"?e==="all"||e==="screen":this.modelValue.data.type=="2"?e==="all"||e==="frame":!0}},methods:{nodeToggleShow(e){this.modelValue.hideChild=e,U.emit("nodeToggleShow",this.modelValue)}},mounted(){}};function Zt(e,t,o,l,a,n){const r=$t,u=F("tree-data-node",!0);return M((c(),h("div",{class:y(["tree-data-node",n.treeDataNodeClass])},[o.direction==="left"?(c(),C(r,{key:0,dataModel:o.modelValue,direction:o.direction,onToggleShow:n.nodeToggleShow},null,8,["dataModel","direction","onToggleShow"])):g("",!0),s(de,null,{default:i(()=>[M(d("div",{class:y({"node-item-box-z":!!o.modelValue.items})},[s(Ae,null,{default:i(()=>[(c(!0),h(L,null,Q(o.modelValue.items,(p,m)=>(c(),h("div",{key:p.id,class:y({"node-item-z":!!o.modelValue.items})},[s(u,{modelValue:o.modelValue.items[m],"onUpdate:modelValue":v=>o.modelValue.items[m]=v,direction:o.direction},null,8,["modelValue","onUpdate:modelValue","direction"])],2))),128))]),_:1})],2),[[T,!o.modelValue.hideChild&&o.modelValue.items.length]])]),_:1}),o.direction==="right"?(c(),C(r,{key:1,dataModel:o.modelValue,direction:o.direction,onToggleShow:n.nodeToggleShow},null,8,["dataModel","direction","onToggleShow"])):g("",!0)],2)),[[T,n.showCurrentNode]])}const Xt=w(Jt,[["render",Zt],["__scopeId","data-v-d737ffd9"]]),Kt={data(){return{centerDialogVisible:!1,showLine2:!1}},methods:{notifyEvent(e,...t){this.$emit(e,...t)},toggleToolBoxPanel(){this.showLine2=!this.showLine2}}};const Yt={class:"tool-box"},eo={class:"el-icon"},to={class:"el-icon"},oo={class:"el-icon"},no={class:"el-icon"},ao={class:"el-icon"},so={class:"el-icon"},lo={class:"el-icon"},io={key:0,style:{"border-top":"0.5px solid transparent"}},ro={class:"el-icon"},uo={class:"el-icon"},co={class:"el-icon"},mo={class:"el-icon"},_o={class:"el-icon"};function po(e,t,o,l,a,n){const r=ke,u=V,p=xe,m=Se,v=we,b=Ie,x=re,I=Ee,W=Fe,z=Me,P=Pe;return c(),h("div",Yt,[d("div",null,[s(x,null,{default:i(()=>[s(u,{type:"primary",onClick:t[0]||(t[0]=D(k=>n.notifyEvent("changePremises"),["prevent"]))},{default:i(()=>[d("i",eo,[s(r)]),_("切换楼盘")]),_:1}),s(u,{type:"primary",onClick:t[1]||(t[1]=D(k=>n.notifyEvent("expandCollapseAll",!1),["prevent"]))},{default:i(()=>[d("i",to,[s(p)]),_("展开")]),_:1}),s(u,{type:"primary",onClick:t[2]||(t[2]=D(k=>n.notifyEvent("expandCollapseAll",!0),["prevent"]))},{default:i(()=>[d("i",oo,[s(m)]),_("收缩")]),_:1}),s(u,{type:"primary",onClick:t[3]||(t[3]=D(k=>n.notifyEvent("zoomIn"),["prevent"]))},{default:i(()=>[d("i",no,[s(p)]),_("放大")]),_:1}),s(u,{type:"primary",onClick:t[4]||(t[4]=D(k=>n.notifyEvent("zoomOut"),["prevent"]))},{default:i(()=>[d("i",ao,[s(m)]),_("缩小")]),_:1}),s(u,{type:"primary",onClick:t[5]||(t[5]=D(k=>n.notifyEvent("toggleFullScreen"),["prevent"]))},{default:i(()=>[d("i",so,[s(p)]),_("全屏")]),_:1}),s(u,{type:"primary",onClick:D(n.toggleToolBoxPanel,["prevent"])},{default:i(()=>[d("i",lo,[M(s(v,null,null,512),[[T,!a.showLine2]]),M(s(b,null,null,512),[[T,a.showLine2]])])]),_:1},8,["onClick"])]),_:1})]),s(de,null,{default:i(()=>[a.showLine2?(c(),h("div",io,[s(x,null,{default:i(()=>[s(u,{type:"primary",onClick:t[6]||(t[6]=D(k=>n.notifyEvent("exportSQL"),["prevent"]))},{default:i(()=>[d("i",ro,[s(I)]),_("生成SQL")]),_:1}),s(u,{type:"primary",onClick:t[7]||(t[7]=D(k=>n.notifyEvent("exportDiagram"),["prevent"]))},{default:i(()=>[d("i",uo,[s(I)]),_("PNG")]),_:1}),s(u,{type:"primary",onClick:t[8]||(t[8]=D(k=>n.notifyEvent("showRecordTextPanel"),["prevent"]))},{default:i(()=>[d("i",co,[s(W)]),_("记录本")]),_:1}),s(u,{type:"primary",onClick:t[9]||(t[9]=D(k=>n.notifyEvent("help"),["prevent"]))},{default:i(()=>[d("i",mo,[s(z)]),_("帮助")]),_:1}),s(u,{type:"primary",onClick:t[10]||(t[10]=D(k=>n.notifyEvent("settings"),["prevent"]))},{default:i(()=>[d("i",_o,[s(P)]),_("设置")]),_:1})]),_:1})])):g("",!0)]),_:1})])}const ho=w(Kt,[["render",po],["__scopeId","data-v-9f0c326b"]]);let me=[{levelCnName:"楼盘",levelName:"premises",level:1},{levelCnName:"楼栋",levelName:"build",level:2},{levelCnName:"单元",levelName:"unit",level:3},{levelCnName:"电梯",levelName:"ele",level:4},{levelCnName:"点位",levelName:"point",level:5}],go={};me.forEach(e=>go[e.levelName]=e.level);const fo=()=>{const e=[{title:"使用说明导航",element:".level-button-group",intro:"这里是资源层级视图切换工具",position:"bottom"},{title:"使用说明导航",element:".tool-box",intro:"<div>这里是一些工具按钮区域<br/>可以进行将数据图导出为PNG或PDF，放大与缩小，展开与折叠</div>",position:"bottom"},{title:"使用说明导航",intro:"左侧是SSP树型数据，右侧是融媒树型数据！",position:"center"},{title:"快捷键支持",intro:"<div>[ 缩小<br/> ] 放大 <br/> ctrl+1 文本记录工具</div>",position:"center"},{title:"使用说明导航",intro:"工具介绍完毕，让我们开始修复数据吧！<br/><br/>开发人员：唐成<br/>工号：XC18377",position:"center"}];Ge().setOptions({prevLabel:"上一步",nextLabel:"下一步",skipLabel:"跳过",doneLabel:"完成",tooltipPosition:"bottom",tooltipClass:"intro-tooltip",highlightClass:"intro-highlight",exitOnEsc:!0,exitOnOverlayClick:!1,helperElementPadding:2,showStepNumbers:!1,keyboardNavigation:!0,showButtons:!0,showBullets:!1,showProgress:!1,scrollToElement:!0,overlayOpacity:.9,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1,steps:e}).oncomplete(()=>{console.log("oncomplete")}).onexit(()=>{console.log("onexit")}).onchange(()=>{console.log("onchange")}).start()},vo={components:{ExportDialog:ce},data(){let e=ze.jsPlumb.getInstance();return e.importDefaults({Anchors:["Left","Right"],Connector:["Bezier",{curviness:40}],ConnectionsDetachable:!1,DeleteEndpointsOnDetach:!1,Endpoints:[["Dot",{radius:2}],["Dot",{radius:2}]],EndpointStyle:{fill:"skyblue",outlineWidth:1},PaintStyle:{stroke:"#000000",strokeWidth:1,outlineStroke:"transparent",outlineWidth:10},Overlays:[["Arrow",{width:10,length:8,location:1,direction:1,foldback:.623}]],RenderMode:"svg",DragOptions:{cursor:"pointer",zIndex:2e3},HoverPaintStyle:{stroke:"skyblue",strokeWidth:3,cursor:"pointer"}}),e.setZoom(.8),{loading:!0,premisesIds:["593168","593563"],data:[],endPointList:null,lineList:null,direction:"left",scale:.8,jsPlumbInstance:e,jsPlumbConnectOptions:{isSource:!0,isTarget:!0,anchor:"Continuous",overlays:[["Arrow",{width:8,length:8,location:1}]]},commonLink:{isSource:!0,isTarget:!0,anchor:["Perimeter",{shape:"Circle"}],connector:"Bezier",endpoint:"Dot",maxConnections:-1},dataNodeLevelItems:me,currentContextMenuNode:null}},computed:{isSupportClipboard(){return E.isSupported()},mainWorkspaceStyle(){return{transform:`scale(${this.scale})`,"transform-origin":"0 0 0"}},currentDataNodeLevel(){return N().getCurrentLevel()},nodeShowMode(){return X().getShowNodeMode()}},methods:{init(){this.loading=!0;const e=this.loadPremisesTreeNodeData();Promise.all(e).then(()=>{this.initEndpointAndLines(),this.draw(),this.loading=!1})},drawLines(){},draw(){},initEndpointAndLines(){let e=[[],[],[],[],[]],t=[[],[],[],[],[]],o=(n,r)=>{const p={endPointId:r.group==="leftGroup"?`sspnode_${r.nodeType}_${r.data.sspId}`:`rmnode_${r.nodeType}_${r.id}`,type:r.nodeType,depth:r.depth};t[r.depth-1].push(p)},l=(n,r)=>{const u={sourceDataNode:r,targetDataNode:null,source:`rmnode_${r.nodeType}_${r.id}`,target:`sspnode_${r.nodeType}_${r.data.sspId}`,overlays:[["Arrow",{width:10,length:10,location:.5}]]};e[r.depth-1].push(u)},a=(n,r)=>{o(n,r),l(n,r)};for(let n of this.data)o(null,n.rightData),this.recursionTreeDataFun(n.rightData,o),a(null,n.rightData),this.recursionTreeDataFun(n.rightData,a);this.endPointList=t,this.lineList=e},loadPremisesTreeNodeData(){this.data=[];let e=[];for(let t of this.premisesIds)e.push(Je(t).then(o=>{let l=o.left,a=o.right;this.data.push({leftData:l,rightData:a}),this.dataInitConvert(l,"leftGroup"),this.dataInitConvert(a,"rightGroup")}));return e},dataInitConvert(e,t){if(e==null)return;e.group=t||"group_"+e.id,e.depth=1;const o=N().getCurrentLevel();return this.recursionTreeDataFun(e,(l,a)=>{a.parent=l,a.group=l.group,a.depth=l.depth+1,l.hideChild=o<l.depth+1}),e},recursionTreeDataFun(e,t){if(e!==null)for(let o of e.items)t(e,o),this.recursionTreeDataFun(o,t)},toggleFullScreen(){return te.isEnabled?(te.toggle(),!1):(this.$message({message:"您的浏览器不能全屏!",type:"error"}),!1)},zoomIn(){parseFloat(new Number(this.scale).toFixed(1))<2&&(this.scale=this.scale+.1,this.jsPlumbInstance.setZoom(this.scale))},zoomOut(){parseFloat(new Number(this.scale).toFixed(1))>.1&&(this.scale=this.scale-.1,this.jsPlumbInstance.setZoom(this.scale))},expandCollapseAll(e){let t=o=>{if(o!=null){o.hideChild=e;for(let l of o.items)t(l)}};for(let o of this.data)t(o.leftData),t(o.rightData)},isNodeHide(e){for(;e.parent;){if(e.parent.hideChild)return!0;e=e.parent}return!1},dataNodeLevelItemClick(e){N().setCurrentLevel(e.level);let t=(o,l)=>{o.hideChild=e.level<o.depth+1};for(let o of this.data)this.recursionTreeDataFun(o.leftData,t),this.recursionTreeDataFun(o.rightData,t)},isAllNodeLoaded(){let e={isLoaded:!0},t=(o,l)=>{e.isLoaded=e.isLoaded&&!!l.loadStatus};for(let o of this.data)e.isLoaded=e.isLoaded&&!!o.leftData.loadStatus,e.isLoaded=e.isLoaded&&!!o.rightData.loadStatus,this.recursionTreeDataFun(o.leftData,t),this.recursionTreeDataFun(o.rightData,t);return e.isLoaded},screenToCanvas(e,t,o){const l=this.$refs.baseEl,a=l.scrollHeight,n=l.style.height;l.style.height=a+"px";let r=null;if(e===1?r=this.$refs.mainWorkSpace:e===2?r=this.$refs.leftWorkSpace:e===3&&(r=this.$refs.rightWorkSpace),!r){this.$message({message:"未找到要导出的工作空间节点信息,不能进行导出!",type:"error"}),o&&o();return}let u=r instanceof Array?r:[r];for(let p of u)We(p,{allowTaint:!0,useCORS:!1,logging:!1,height:l.scrollHeight,width:l.scrollWidth,scale:2,y:20}).then(function(m){l.style.height=n,t&&t(m)})},exportDiagram(){this.$refs.exportDialog.openDialog()},async exportPDF(e){this.screenToCanvas(e,t=>{let o=t.width,l=t.height,a=841.89,n=595.28,r=o/n*a,u=l;Math.floor(t.width/n*a);let p=0,m=n,v=n/o*l,b=t.toDataURL("image/jpeg",1),x=new Re("p","pt",[n,a]);if(u<r)x.addImage(b,"JPEG",0,0,m,v);else for(;u>0;)x.addImage(b,"JPEG",0,p,m,v),u-=r,p-=a,u>0&&x.addPage();x.save("title"),this.$refs.exportDialog.closeDialog()},()=>this.$refs.exportDialog.closeDialog())},async exportPNG(e){this.screenToCanvas(e,t=>{var o=new Image;o.src=t.toDataURL("image/png");var l=document.createElement("a");l.href=o.src,l.download="screenshot.png",l.click(),l.remove(),this.$refs.exportDialog.closeDialog()},()=>this.$refs.exportDialog.closeDialog())},exportSQL(){this.$refs.showSqlDialog.showSql(this.data)},help(){fo()},renameDataNode(){alert("功能开发中，敬请期待！")},changePremises(){this.$refs.settingPremisesDialog.openDialog()},changePremisesId(e){this.premisesIds=e.split(","),this.init()},showRecordTextPanel(e){e&&e.preventDefault(),this.$refs.textPanel.openDialog()},showSettingDrawer(){this.$refs.settingDrawer.showDrawer()},copyId(e){E.copy(e.nodeData.id),this.$message({message:"拷贝成功",type:"success"})},copyTitle(e){E.copy(e.nodeData.title||"未设置"),this.$message({message:"拷贝成功",type:"success"})},copySSPId(e){E.copy(e.nodeData.data.sspId||"无"),this.$message({message:"拷贝成功",type:"success"})},copyDetail(e){E.copy(e.currentNodeTarget.innerText),this.$message({message:"拷贝成功",type:"success"})}},mounted(){const e=Le("emitContext");B("[",this.zoomOut),B("]",this.zoomIn),B("ctrl+1",this.showRecordTextPanel);let t=()=>{this.isAllNodeLoaded()?this.jsPlumbInstance.ready(()=>{}):this.$nextTick(t)};this.$nextTick(t),U.on("nodeContextMenu",o=>{this.currentContextMenuNode=o.nodeData,e(event,{name:"context-menu-1",nodeData:o.nodeData,currentNodeTarget:event.currentTarget})})},unmounted(){B.unbind("[]","]"),U.off("nodeContextMenu")},created(){this.init()}};const Do={class:"data-fix-workspace",ref:"baseEl"},yo={class:"tool-box-group",id:"step1"},Co={class:"level-button-group"},bo={class:"el-icon"};function ko(e,t,o,l,a,n){const r=Ve,u=V,p=re,m=ho,v=Xt,b=ce,x=Ft,I=Ct,W=ht,z=ct,P=F("context-menu-item"),k=F("context-menu-submenu"),_e=F("context-menu"),pe=ae;return c(),h("div",Do,[d("div",yo,[d("div",Co,[s(p,null,{default:i(()=>[(c(!0),h(L,null,Q(a.dataNodeLevelItems,S=>(c(),C(u,{type:"primary",key:"dataNodeLevel"+S.level,style:ee(n.currentDataNodeLevel<S.level?{opacity:.5}:{}),onClick:K=>n.dataNodeLevelItemClick(S)},{default:i(()=>[d("i",bo,[s(r)]),_(f(S.levelCnName),1)]),_:2},1032,["style","onClick"]))),128))]),_:1})]),s(m,{onChangePremises:n.changePremises,onExpandCollapseAll:n.expandCollapseAll,onZoomIn:n.zoomIn,onZoomOut:n.zoomOut,onToggleFullScreen:n.toggleFullScreen,onExportSQL:n.exportSQL,onExportDiagram:n.exportDiagram,onShowRecordTextPanel:n.showRecordTextPanel,onHelp:n.help,onSettings:n.showSettingDrawer},null,8,["onChangePremises","onExpandCollapseAll","onZoomIn","onZoomOut","onToggleFullScreen","onExportSQL","onExportDiagram","onShowRecordTextPanel","onHelp","onSettings"])]),d("div",{class:"main-workspace",style:ee(n.mainWorkspaceStyle),ref:"mainWorkSpace"},[(c(!0),h(L,null,Q(a.data,(S,K)=>M((c(),h("div",{key:`stage_${K}`,class:"workspace-column-box"},[S.leftData?(c(),h("div",{key:0,class:"workspace-column left-column",ref_for:!0,ref:"leftWorkSpace"},[s(v,{modelValue:S.leftData,"onUpdate:modelValue":G=>S.leftData=G,direction:a.direction},null,8,["modelValue","onUpdate:modelValue","direction"])],512)):g("",!0),S.rightData&&(n.nodeShowMode=="all"||n.nodeShowMode=="frame")?(c(),h("div",{key:1,class:"workspace-column right-column",ref_for:!0,ref:"rightWorkSpace"},[s(v,{modelValue:S.rightData,"onUpdate:modelValue":G=>S.rightData=G,direction:"right"},null,8,["modelValue","onUpdate:modelValue"])],512)):g("",!0)])),[[pe,a.loading]])),128))],4),s(b,{ref:"exportDialog",onExportPNG:n.exportPNG,onExportPDF:n.exportPDF},null,8,["onExportPNG","onExportPDF"]),s(x,{ref:"showSqlDialog"},null,512),s(I,{ref:"settingPremisesDialog",onSettingPremisesId:n.changePremisesId},null,8,["onSettingPremisesId"]),s(W,{ref:"textPanel"},null,512),s(z,{ref:"settingDrawer"},null,512),s(_e,{name:"context-menu-1"},{default:i(()=>[n.isSupportClipboard?(c(),C(k,{key:0,label:"复制"},{default:i(()=>[s(P,{onItemClickHandle:n.copyId},{default:i(()=>[_("ID")]),_:1},8,["onItemClickHandle"]),s(P,{onItemClickHandle:n.copyTitle},{default:i(()=>[_("名称")]),_:1},8,["onItemClickHandle"]),a.currentContextMenuNode&&a.currentContextMenuNode.group=="rightGroup"?(c(),C(P,{key:0,onItemClickHandle:n.copySSPId},{default:i(()=>[_("sspId")]),_:1},8,["onItemClickHandle"])):g("",!0),s(P,{onItemClickHandle:n.copyDetail},{default:i(()=>[_("详细信息")]),_:1},8,["onItemClickHandle"])]),_:1})):g("",!0),s(P,{onItemClickHandle:n.renameDataNode},{default:i(()=>[_("重命名")]),_:1},8,["onItemClickHandle"])]),_:1})],512)}const xo=w(vo,[["render",ko],["__scopeId","data-v-94aebb74"]]),So=Ue({history:qe("/"),routes:[{path:"/",name:"settings",component:it},{path:"/workspace",name:"home",component:xo}]}),R=Be($e);R.provide("$axios",A);R.use(Ne()).use(So).use(ye).use(Ce);for(let e in Y)R.component(e,Y[e]);R.mount("#app");
